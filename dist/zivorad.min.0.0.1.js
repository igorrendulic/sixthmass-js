var $jscomp={scope:{},checkStringArgs:function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""}};
$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(c.get||c.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=c.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.polyfill=function(a,b,c,d){if(b){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var f=a[d];f in c||(c[f]={});c=c[f]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(a,c){return-1!==$jscomp.checkStringArgs(this,a,"includes").indexOf(a,c||0)}},"es6-impl","es3");
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(a,c){var b=$jscomp.checkStringArgs(this,a,"startsWith");a+="";for(var f=b.length,e=a.length,g=Math.max(0,Math.min(c|0,b.length)),h=0;h<e&&g<f;)if(b[g++]!=a[h++])return!1;return h>=e}},"es6-impl","es3");var zr_util={},XMLHttpFactories=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")},function(){return new ActiveXObject("Microsoft.XMLHTTP")}];
zr_util.createXMLHTTPObject=function(){for(var a=!1,b=0;b<XMLHttpFactories.length;b++){try{a=XMLHttpFactories[b]()}catch(c){continue}break}return a};zr_util.timestamp=function(){Date.now=Date.now||function(){return+new Date};return Date.now()};zr_util.isBlockedUA=function(a){return/(google web preview|baiduspider|yandexbot|bingbot|googlebot|yahoo! slurp)/i.test(a)?!0:!1};zr_util.isTag=function(a,b){return a&&a.tagName&&a.tagName.toLowerCase()===b.toLowerCase()};
zr_util.formatDate=function(a){function b(a){return 10>a?"0"+a:a}return a.getUTCFullYear()+"-"+b(a.getUTCMonth()+1)+"-"+b(a.getUTCDate())+"T"+b(a.getUTCHours())+":"+b(a.getUTCMinutes())+":"+b(a.getUTCSeconds())};zr_util.each=function(a,b,c){if(null!==a&&void 0!==a)if(Array.prototype&&a.forEach===Array.prototype)a.forEach(b,c);else if(a.length===+a.length)for(var d=0,f=a.length;d<f&&!(d in a&&b.call(c,a[d],d,a)==={});d++);else for(d in a)if(hasOwnProperty.call(a,d)&&b.call(c,a[d],d,a)==={})break};
zr_util.isUndefined=function(a){return void 0===a};zr_util.shouldTrackDOMEvent=function(a){if(!a||this.isTag(a,"html")||a.nodeType!==ELEMENT_NODE)return!1;switch(a.tagName.toLowerCase()){case "html":return!1;case "form":return"submit"===event.type;case "input":return-1===["button","submit"].indexOf(a.getAttribute("type"))?!1:"click"===event.type;case "select":case "textarea":return!1;default:return"click"===event.type}};
zr_util.getClassName=function(a){switch(typeof a.className){case "string":return a.className;case "object":return a.className.baseVal||a.getAttribute("class")||"";default:return""}};zr_util.getPropertiesFromElement=function(a){var b={classes:this.getClassName(a).split(" "),tag_name:a.tagName.toLowerCase()},c=[];this.each(a.attributes,function(a){c.push({name:a.name,value:a.value})});b.attributes=c;return b};
zr_util.islocalStorageSupported=function(){var a=!0;try{zr_util.localStorage.set("__zrstoragesupport__","zivorad"),"zivorad"!==zr_util.localStorage.get("__zrstoragesupport__")&&(a=!1),zr_util.localStorage.remove("__zrstoragesupport__")}catch(b){a=!1}a||console.error("localStorage unsupported; falling back to cookie store");return a};
zr_util.uuid4=function(){var a=Date.now();window.performance&&"function"===typeof window.performance.now&&(a+=performance.now());return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;a=Math.floor(a/16);return("x"==b?c:c&3|8).toString(16)})};zr_util.timestamp=function(){Date.now=Date.now||function(){return+new Date};return Date.now()};zr_util.timezone=function(){return(new Date).getTimezoneOffset()};
zr_util.isArray=Array.isArray||function(a){return"[object Array]"===toString.call(a)};zr_util.storage={get:function(a,b){return b&&"_zr_local"===b?zr_util.localStorage.get(a):zr_util.cookie.get(a)},set:function(a,b,c){c&&"_zr_local"===c?zr_util.localStorage.set(a,b):zr_util.cookie.set(a,b,5E3,!0,!0)},remove:function(a,b){b&&"_zr_local"===b?zr_util.localStorage.remove(a):zr_util.cookie.remove(a,!0)},parse:function(a,b){return b&&"_zr_local"===b?zr_util.localStorage.parse(a):zr_util.cookie.parse(a)}};
zr_util.localStorage={error:function(a){console.error("localStorage error: "+a)},get:function(a){try{return window.localStorage.getItem(a)}catch(b){console.error(b)}return null},parse:function(a){try{return zr_util.JSONDecode(zr_util.localStorage.get(a))||{}}catch(b){}return null},set:function(a,b){try{window.localStorage.setItem(a,b)}catch(c){console.error(c)}},remove:function(a){try{window.localStorage.removeItem(a)}catch(b){console.error(b)}}};
zr_util.cookieStorage={get:function(a){a+="=";for(var b=document.cookie.split(";"),c=0;c<b.length;c++){for(var d=b[c];" "==d.charAt(0);)d=d.substring(1,d.length);if(0===d.indexOf(a))return decodeURIComponent(d.substring(a.length,d.length))}return null},parse:function(a){var b;try{b=zr_util.JSONDecode(zr_util.cookie.get(a))||{}}catch(c){}return b},set_seconds:function(a,b,c,d,f){var e="",g="",h="";d&&(e=(e=(e=document.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i))?e[0]:"")?"; domain=."+
e:"");c&&(g=new Date,g.setTime(g.getTime()+1E3*c),g="; expires="+g.toGMTString());f&&(h="; secure");document.cookie=a+"="+encodeURIComponent(b)+g+"; path=/"+e+h},set:function(a,b,c,d,f){var e="",g="",h="";d&&(e=(e=(e=document.location.hostname.match(/[a-z0-9][a-z0-9\-]+\.[a-z\.]{2,6}$/i))?e[0]:"")?"; domain=."+e:"");c&&(g=new Date,g.setTime(g.getTime()+864E5*c),g="; expires="+g.toGMTString());f&&(h="; secure");a=a+"="+encodeURIComponent(b)+g+"; path=/"+e+h;return document.cookie=a},remove:function(a,
b){document.cookie.set(a,"",-1,b)}};zr_util.getQueryParam=function(a,b){b=b.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=(new RegExp("[\\?&]"+b+"=([^&#]*)")).exec(a);return null===c||c&&"string"!==typeof c[1]&&c[1].length?"":decodeURIComponent(c[1]).replace(/\+/g," ")};zr_util.includes=function(a,b){return-1!==a.indexOf(b)};
zr_util.referingFrom={domain:function(a){a=a.split("/");return 3<=a.length?a[2]:null},searchEngine:function(a){return 0===a.search("https?://(.*)google.([^/?]*)")?"google":0===a.search("https?://(.*)bing.com")?"bing":0===a.search("https?://(.*)yahoo.com")?"yahoo":0===a.search("https?://(.*)duckduckgo.com")?"duckduckgo":null},searchQuery:function(a){var b=zr_util.referingFrom.searchEngine(a),c="";null!==b&&(a=zr_util.getQueryParam(a,"yahoo"!=b?"q":"p"),a.length&&(c=c+","+a));return c},browser:function(a,
b,c){b=b||"";return c||zr_util.includes(a," OPR/")?zr_util.includes(a,"Mini")?"Opera Mini":"Opera":/(BlackBerry|PlayBook|BB10)/i.test(a)?"BlackBerry":zr_util.includes(a,"IEMobile")||zr_util.includes(a,"WPDesktop")?"Internet Explorer Mobile":zr_util.includes(a,"Edge")?"Microsoft Edge":zr_util.includes(a,"FBIOS")?"Facebook Mobile":zr_util.includes(a,"Chrome")?"Chrome":zr_util.includes(a,"CriOS")?"Chrome iOS":zr_util.includes(a,"UCWEB")||zr_util.includes(a,"UCBrowser")?"UC Browser":zr_util.includes(a,
"FxiOS")?"Firefox iOS":zr_util.includes(b,"Apple")?zr_util.includes(a,"Mobile")?"Mobile Safari":"Safari":zr_util.includes(a,"Android")?"Android Mobile":zr_util.includes(a,"Konqueror")?"Konqueror":zr_util.includes(a,"Firefox")?"Firefox":zr_util.includes(a,"MSIE")||zr_util.includes(a,"Trident/")?"Internet Explorer":zr_util.includes(a,"Gecko")?"Mozilla":null},browserVersion:function(a,b,c){b={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,
"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/}[zr_util.referingFrom.browser(a,b,c)];return void 0===
b?null:(a=a.match(b))?parseFloat(a[a.length-2]):null},os:function(a){return/Windows/i.test(a)?/Phone/.test(a)||/WPDesktop/.test(a)?"Windows Phone":"Windows":/(iPhone|iPad|iPod)/.test(a)?"iOS":/Android/.test(a)?"Android":/(BlackBerry|PlayBook|BB10)/i.test(a)?"BlackBerry":/Mac/i.test(a)?"Mac OS X":/Linux/.test(a)?"Linux":null},device:function(a){return/Windows Phone/i.test(a)||/WPDesktop/.test(a)?"Windows Phone":/iPad/.test(a)?"iPad":/iPod/.test(a)?"iPod Touch":/iPhone/.test(a)?"iPhone":/(BlackBerry|PlayBook|BB10)/i.test(a)?
"BlackBerry":/Android/.test(a)?"Android":null},language:function(){return navigator.language||navigator.userLanguage}};
zr_util.encodeUTF8=function(a){for(var b=0,c=new Uint8Array(4*a.length),d=0;d!=a.length;d++){var f=a.charCodeAt(d);if(128>f)c[b++]=f;else{if(2048>f)c[b++]=f>>6|192;else{if(55295<f&&56320>f){if(++d==a.length)throw"UTF-8 encode: incomplete surrogate pair";var e=a.charCodeAt(d);if(56320>e||57343<e)throw"UTF-8 encode: second char code 0x"+e.toString(16)+" at index "+d+" in surrogate pair out of range";f=65536+((f&1023)<<10)+(e&1023);c[b++]=f>>18|240;c[b++]=f>>12&63|128}else c[b++]=f>>12|224;c[b++]=f>>
6&63|128}c[b++]=f&63|128}}return c.subarray(0,b)};
zr_util.decodeUTF8=function(a){for(var b="",c=0;c<a.length;){var d=a[c++];if(127<d){if(191<d&&224>d){if(c>=a.length)throw"UTF-8 decode: incomplete 2-byte sequence";d=(d&31)<<6|a[c]&63}else if(223<d&&240>d){if(c+1>=a.length)throw"UTF-8 decode: incomplete 3-byte sequence";d=(d&15)<<12|(a[c]&63)<<6|a[++c]&63}else if(239<d&&248>d){if(c+2>=a.length)throw"UTF-8 decode: incomplete 4-byte sequence";d=(d&7)<<18|(a[c]&63)<<12|(a[++c]&63)<<6|a[++c]&63}else throw"UTF-8 decode: unknown multibyte start 0x"+d.toString(16)+
" at index "+(c-1);++c}if(65535>=d)b+=String.fromCharCode(d);else if(1114111>=d)d-=65536,b+=String.fromCharCode(d>>10|55296),b+=String.fromCharCode(d&1023|56320);else throw"UTF-8 decode: code point 0x"+d.toString(16)+" exceeds UTF-16 reach";}return b};
zr_util.JSONDecode=function(){var a,b,c={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},d,f=function(b){throw{name:"SyntaxError",message:b,at:a,text:d};},e=function(c){c&&c!==b&&f("Expected '"+c+"' instead of '"+b+"'");b=d.charAt(a);a+=1;return b},g=function(){var a;a="";"-"===b&&(a="-",e("-"));for(;"0"<=b&&"9">=b;)a+=b,e();if("."===b)for(a+=".";e()&&"0"<=b&&"9">=b;)a+=b;if("e"===b||"E"===b){a+=b;e();if("-"===b||"+"===b)a+=b,e();for(;"0"<=b&&"9">=b;)a+=b,e()}a=+a;if(isFinite(a))return a;
f("Bad number")},h=function(){var a,d,g="",h;if('"'===b)for(;e();){if('"'===b)return e(),g;if("\\"===b)if(e(),"u"===b){for(d=h=0;4>d;d+=1){a=parseInt(e(),16);if(!isFinite(a))break;h=16*h+a}g+=String.fromCharCode(h)}else if("string"===typeof c[b])g+=c[b];else break;else g+=b}f("Bad string")},l=function(){for(;b&&" ">=b;)e()},m=function(){switch(b){case "t":return e("t"),e("r"),e("u"),e("e"),!0;case "f":return e("f"),e("a"),e("l"),e("s"),e("e"),!1;case "n":return e("n"),e("u"),e("l"),e("l"),null}f('Unexpected "'+
b+'"')},k;k=function(){l();switch(b){case "{":var a;a:{var c={};if("{"===b){e("{");l();if("}"===b){e("}");a=c;break a}for(;b;){a=h();l();e(":");Object.hasOwnProperty.call(c,a)&&f('Duplicate key "'+a+'"');c[a]=k();l();if("}"===b){e("}");a=c;break a}e(",");l()}}f("Bad object");a=void 0}return a;case "[":a:{a=[];if("["===b){e("[");l();if("]"===b){e("]");break a}for(;b;){a.push(k());l();if("]"===b){e("]");break a}e(",");l()}}f("Bad array");a=void 0}return a;case '"':return h();case "-":return g();default:return"0"<=
b&&"9">=b?g():m()}};return function(c){d=c;a=0;b=" ";c=k();l();b&&f("Syntax error");return c}}();
zr_util.JSONEncode=function(){return function(a){var b=function(a){var b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,c={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};b.lastIndex=0;return b.test(a)?'"'+a.replace(b,function(a){var b=c[a];return"string"===typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'},c=function(a,f){var d="",g;g="";var h,l=d,m,k=f[a];k&&"object"===
typeof k&&"function"===typeof k.toJSON&&(k=k.toJSON(a));switch(typeof k){case "string":return b(k);case "number":return isFinite(k)?String(k):"null";case "boolean":case "null":return String(k);case "object":if(!k)return"null";d+="    ";m=[];if("[object Array]"===toString.apply(k)){h=k.length;for(g=0;g<h;g+=1)m[g]=c(g,k)||"null";return h=0===m.length?"[]":d?"[\n"+d+m.join(",\n"+d)+"\n"+l+"]":"["+m.join(",")+"]"}for(g in k)hasOwnProperty.call(k,g)&&(h=c(g,k))&&m.push(b(g)+(d?": ":":")+h);return h=0===
m.length?"{}":d?"{"+m.join(",")+""+l+"}":"{"+m.join(",")+"}"}};return c("",{"":a})}}();var ELEMENT_NODE=1,TEXT_NODE=3,STORAGE_LOCAL="_zr_local",STORAGE_COOKIES="_zr_cookies",STORAGE_USER_PROFILE="_zr_user_profile",STORAGE_SESSION="_zr_session",STORAGE_QUEUE="_zr_queue",STORAGE_QUEUE_INDEX="_zr_queue_index",INACTIVE_SESSION_RESET=30,URL="http://localhost:8079/v1/event",URL_PROFILE="http://localhost:8079/v1/profile",globalDataQueue=[],zr_instance,Config={DEBUG:!0,LIB_VERSION:"0.0.1",events:["click"],attributePrefix:"zr-",trackOnlyZr:!0},PostfixAction="event",ZivoradLib=function(){};
function _zr_init(){var a=window.zr;if(a){var b=new ZivoradLib;b.executeFunctions(a,b);return zr_instance=b}console.error("zivorad object undefined!")}
ZivoradLib.prototype.init=function(a){this.initParams={token:a};this.Config=Config;null!=this.initParams.trackOnlyZr&&(this.Config.trackOnlyZr=this.initParams.trackOnlyZr);zr_util.islocalStorageSupported()?this.Config.storage=STORAGE_LOCAL:this.Config.storage=STORAGE_COOKIES;this.PostfixAction=PostfixAction;this.initUser();a=this.Config.events;for(var b=0;b<a.length;b++)this.registerEvent(a[b],document,!0)};ZivoradLib.prototype.track=function(a,b){var c=this.createEvent(a,b,this);this.queueEvent(c)};
ZivoradLib.prototype.profile=function(a,b){var c=this.createProfile(a,b,this),d={};d.data=c;this.httpRequest(d,this.getProfileUrl(),1,!1)};ZivoradLib.prototype.purchase=function(a){zr_util.isArray(a)?(a=this.createPurchase(a,this),this.queueEvent(a)):console.error("Required array of purchased items.")};ZivoradLib.prototype.register=function(a,b){var c=this.createRegister(a,b,this);this.queueEvent(c);this.profile(a,b)};
ZivoradLib.prototype.executeFunctions=function(a,b){a&&zr_util.each(a,function(a){var c=a[0];0<a.length&&(a.shift(),c=this[c],"function"===typeof c&&c.apply(b,a))},this)};ZivoradLib.prototype.getUrl=function(){return URL};ZivoradLib.prototype.getProfileUrl=function(){return URL_PROFILE};ZivoradLib.prototype.registerEvent=function(a,b,c){b||console.error("No valid element provided for registerEvent");var d=this;b.addEventListener(a,function(a){d.handleEvents(a,d)},c)};
ZivoradLib.prototype.handleEvents=function(a,b){if(a){this.touchSession();var c=a.target,c="undefined"===typeof a.target?a.srcElement:a.target;c.nodeType===TEXT_NODE&&(c=c.parentNode);for(var d=[c],f=c;f.parentNode&&!zr_util.isTag(f,"body");)d.push(f.parentNode),f=f.parentNode;if(zr_util.shouldTrackDOMEvent(c)){var e=[];zr_util.each(d,function(a,c){var d=zr_util.getPropertiesFromElement(a);b.Config.trackOnlyZr?d&&zr_util.each(d.attributes,function(a,c){a.name&&a.name.startsWith(b.Config.attributePrefix)&&
e.push(d)}):"a"===d.tag_name?e.push(d):"input"===d.tag_name?zr_util.each(d.attributes,function(a,b){"type"!==a.name||"submit"!==a.value&&"button"!==a.value||e.push(d)}):"button"===d.tag_name&&(b.debug(d.attributes),e.push(d))});b.decorateEvents(e,b)}}};
ZivoradLib.prototype.decorateEvents=function(a,b){b.initParams.token?0<a.length&&zr_util.each(a,function(a){zr_util.each(a.attributes,function(a){a.name===b.Config.attributePrefix+b.PostfixAction&&(a=b.createEvent(a.value,null,b),b.queueEvent(a))})}):console.error("Missing token!")};
ZivoradLib.prototype.createEvent=function(a,b,c){var d={},f=zr_util.storage.parse(STORAGE_USER_PROFILE,c.Config.storage),e=zr_util.storage.parse(STORAGE_SESSION,c.Config.storage);f||(f=this.initUser());d.uId=f.userId;d.cId=c.initParams.token;d.e=a;d.sId=e.sId;d.sessDuration=e.sessDuration;d.ts=zr_util.timestamp();d.tzOffset=60*zr_util.timezone();d.libVer=c.Config.LIB_VERSION;a=zr_util.referingFrom.searchEngine(document.referrer);null!=a?(d.refDomain=a,d.searchQuery=zr_util.referingFrom.searchQuery(document.referrer)):
d.refDomain=zr_util.referingFrom.domain(document.referrer);d.browser=zr_util.referingFrom.browser(window.navigator.userAgent,window.navigator.vendor,window.opera);d.browserVersion=zr_util.referingFrom.browserVersion(window.navigator.userAgent,window.navigator.vendor,window.opera);d.os=zr_util.referingFrom.os(window.navigator.userAgent);d.device=zr_util.referingFrom.device(window.navigator.userAgent);d.lang=zr_util.referingFrom.language();d.pageView=document.location.href;zr_util.isUndefined(b)||(d.customValues=
b);return d};
ZivoradLib.prototype.createProfile=function(a,b,c){var d={},f=zr_util.storage.parse(STORAGE_USER_PROFILE,c.Config.storage);f||(f=c.initUser());d.userId=f.userId;d.clientId=c.initParams.token;d.remoteUserId=a.user_id;d.email=a.email;d.firstName=a.first_name;d.lastName=a.last_name;d.tzOffset=60*zr_util.timezone();d.gender=a.gender;d.businessName=a.business_name;d.birthday=a.birthday;zr_util.isUndefined(b)||(d.customValues=b);zr_util.storage.set(STORAGE_USER_PROFILE,zr_util.JSONEncode(d),c.Config.storage);
return d};ZivoradLib.prototype.createRegister=function(a,b,c){c.createProfile(a,b,this);return c.createEvent("zr_register",null,c)};ZivoradLib.prototype.createPurchase=function(a,b){var c=b.createEvent("zr_purchase",null,b);c.pItems=[];zr_util.each(a,function(a){var b={};b.id=a.id;b.n=a.name;b.pr=a.price;b.q=a.quantity;c.pItems.push(b)});return c};
ZivoradLib.prototype.initUser=function(){var a=zr_util.storage.get(STORAGE_USER_PROFILE,this.Config.storage);null==a&&(a={},a.userId=zr_util.uuid4(),zr_util.storage.set(STORAGE_USER_PROFILE,zr_util.JSONEncode(a),this.Config.storage));this.touchSession();return a};
ZivoradLib.prototype.touchSession=function(){var a=zr_util.storage.parse(STORAGE_SESSION,this.Config.storage);if(null==a)a={},a.sId=zr_util.uuid4(),a.ts=zr_util.timestamp(),a.lastTouch=zr_util.timestamp();else{var b=a.ts,c=a.lastTouch,d=zr_util.timestamp();d-c>6E4*INACTIVE_SESSION_RESET?(console.log("new session defined"),zr_util.storage.remove(STORAGE_QUEUE,this.Config.storage),zr_util.storage.remove(STORAGE_QUEUE_INDEX,this.Config.storage),a.sId=zr_util.uuid4(),a.ts=d):a.sessDuration=(d-b)/1E3;
a.lastTouch=d}zr_util.storage.set(STORAGE_SESSION,zr_util.JSONEncode(a),this.Config.storage);return a};
ZivoradLib.prototype.queueEvent=function(a){var b=null,c=0;try{b=zr_util.islocalStorageSupported()?zr_util.storage.parse(STORAGE_QUEUE,this.Config.storage):globalDataQueue;null==b&&(b=[]);var d={},c=b.push(d)-1;d.queueIndex=c;d.data=a;zr_util.islocalStorageSupported()&&zr_util.storage.set(STORAGE_QUEUE,zr_util.JSONEncode(b),this.Config.storage);this.sendData(b)}catch(f){console.error("storage queue problem:",f)}};
ZivoradLib.prototype.sendData=function(a){if(a)for(var b=0;b<a.length;b++){var c=a[b];if(0<=b-1){var d=a[b-1];c.data.pTs=d.data.ts;c.data.p=d.data.e}c.queueIndex=b;this.httpRequest(c,this.getUrl(),1,!0)}else console.error("required defined queue and url")};
ZivoradLib.prototype.httpRequest=function(a,b,c,d){try{if(!a.sent||1!==a.sent){console.log("sending ...",a);var f=zr_util.createXMLHTTPObject();f.open("POST",b,!0);f.withCredentials=!0;f.setRequestHeader("Content-type","application/json");var e=this;f.onreadystatechange=function(){if(4===f.readyState)if(200===f.status){if(d){var g=zr_util.storage.parse(STORAGE_QUEUE,e.Config.storage);g&&(a.sent=1,a.sentTime=zr_util.timestamp(),g[a.queueIndex]=a,zr_util.storage.set(STORAGE_QUEUE,zr_util.JSONEncode(g),
e.Config.storage),g=zr_util.storage.parse(STORAGE_QUEUE,e.Config.storage))}}else if(1<=c&&15>=c){var h=1===c?2:2*c;console.log("Bad HTTP Status. Retrying: ",h);setTimeout(function(){e.httpRequest(a,b,h)},1E3*h)}else console.error("Bad HTTP status: "+f.status+", "+f.statusText)};f.send(JSON.stringify(a.data))}}catch(g){console.error(g)}};
